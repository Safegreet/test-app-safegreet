import{r as s,b as A,c as D,u as I,d as P,s as h,e as k,f as F,j as e,D as R,F as C,I as T,B as M}from"./index-BEo9QrOL.js";import{u as H}from"./useCompanyGet-C13fvjjl.js";import{l as V,v as _,L as z}from"./react-simple-captcha-IAPy8FTZ.js";const B=()=>{const[w,m]=s.useState(null),u=async n=>(await D.post("/visitor-temp/login",n,{headers:{"Content-Type":"application/json"}})).data,{companyData:t,companyError:r,isCompanyLoading:g,isCompanyError:b,isCompanySuccess:d}=H({token:w}),{mutate:o,data:i,error:p,isLoading:y,isError:j,isSuccess:x}=A(u,{onSuccess:n=>{var l;const c=(l=n==null?void 0:n.data)==null?void 0:l.jwt_token;m(c)}});return{mutate:o,data:i,error:p||r,isLoading:y||g,isError:j||b,isSuccess:x&&d,companyData:t}},q=({numFields:w=6})=>{var N;const[m,u]=s.useState(!1),t=s.useRef([]),r=s.useRef(),g=I(),b=s.useRef(),d=P(),[o,i]=s.useState(!1),[p,y]=s.useState(0);s.useEffect(()=>{V(4,"#000","#fff","numbers")},[]);const{mutate:j,data:x,error:n,isLoading:c,isError:l,isSuccess:E,companyData:v}=B();s.useEffect(()=>{E&&(h.success("OTP Verified !"),d(k(x.data.jwt_token)),d(F(v.data)),g("/"))},[E,x,v]),s.useEffect(()=>{l&&h.error(n.message)},[l,n]),s.useEffect(()=>{r!=null&&r.current&&r.current.focus()},[r]),s.useEffect(()=>{var a,f,S;(f=(a=t==null?void 0:t.current)==null?void 0:a[0])!=null&&f.current&&((S=t==null?void 0:t.current)==null||S[0].current.focus())},[(N=t==null?void 0:t.current)==null?void 0:N[0]]);const L=s.useCallback(a=>{if(!o){if(i(!0),!_(a.captcha)){y(f=>f+1),h.error("CAPTCHA validation failed! Please try again."),setTimeout(()=>i(!1),500);return}a.mobile&&(j({phone_number:a.mobile}),u(!0),i(!1))}},[]);return s.useEffect(()=>{p>5&&(h.error("Max retry limit reached !"),u(!0))},[p]),e.jsx(R,{children:e.jsx("main",{className:"relative h-full flex flex-col justify-center bg-indigo-500 overflow-hidden px-4",children:e.jsxs("div",{className:"w-100 max-w-6xl mx-auto px-0 md:px-6 my-2 mb-12 md:py-24",children:[e.jsx("h1",{className:"text-4xl text-white pacifico-regular w-100 text-center my-5",children:"SafeGreet!"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"w-full mx-auto text-center bg-white px-4 sm:px-8 py-10 rounded-xl shadow",children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-indigo-500 mb-1",children:"Mobile login step"}),e.jsx("p",{className:"text-[15px] text-slate-500 w-80",children:"Enter 10 digit mobile number to continue."})]}),e.jsxs(C,{onFinish:L,ref:b,tabIndex:0,children:[e.jsx(C.Item,{name:"mobile",rules:[{required:!0,message:"Please enter your mobile number!"},{pattern:/^[6-9]\d{9}$/,message:"Please enter a valid 10-digit mobile number!"}],children:e.jsx(T,{type:"number",maxLength:10,placeholder:"Enter your mobile number",className:"w-80 px-4 py-2 border rounded-md",ref:r})}),e.jsx(C.Item,{name:"captcha",className:"flex items-center justify-center",children:e.jsxs("div",{className:"captcha-wrapper w-80",children:[e.jsx(z,{}),e.jsx(T,{placeholder:"Enter the CAPTCHA",maxLength:4,className:"px-4 border rounded-md",pattern:"[a-zA-Z0-9]{4}",onInput:a=>{a.target.value=a.target.value.replace(/[^a-zA-Z0-9]/g,"").toUpperCase()}})]})}),e.jsx(M,{htmlType:"submit",className:"w-80 mt-4 bg-indigo-500 text-white py-2 px-2 rounded-lg",disabled:m||o||c,loading:o||c,children:m?"Resend Disabled":o?"Validating CAPTCHA":"Login"})]})]})})]})})})};export{q as default};
